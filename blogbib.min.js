var BlogBib=function(){function n(n){n===void 0&&(n={});this.width_cover=170;this.width=600;this.endpoint="http://api.openbd.jp/v1/";this.amazon_links={};this.db_links_id={};this.cover_mode="db";this.link_mode="amazon";this.amazon_account=null;$.extend(this,n)}return n.prototype.isASIN=function(n){return n.match(/^[^0-9]/)?!0:!1},n.prototype.convDate=function(n){var t=n.substr(0,4),i=n.substr(4,2),r=n.substr(6,2);return t+"/"+i+"/"+r},n.prototype.toISBN10=function(n){var t,u,r,f,i;if(n.length>10){for(t=[],t=n.substr(3,9).split(""),u=0,i=0;i<9;i++)u+=t[i]*(10-i);return r=11-u%11,f=r==10?"X":r==11?0:r,t.push(f),t.join("")}return n},n.prototype.load_db=function(){var n=this,t=[],r=[],i,u;for(i in this.db_links_id)r.push(this.db_links_id[i]),t.push(i);u="isbn="+t.join(",");$.ajax({type:"POST",url:this.endpoint+"get",data:u,success:function(i){for(var h,c,l,f,e,o,u=0;u<i.length;u++){if(console.log(i[u]),h=i[u].summary.author,c=n.convDate(i[u].summary.pubdate),l=n.cover_mode=="amazon"?n.getAmazonCover(n.toISBN10(t[u])):'<img src= "'+i[u].summary.cover+'" alt= "image" />',f="",e=i[u].onix.CollateralDetail.TextContent,e){for(f+="<li>",o=0;o<e.length;o++)f+="<p>"+e[o].Text+"<\/p>";f+="<\/li>"}var a=n.getAmazonURL(n.toISBN10(t[u])),v='<a href="'+a+'" target="_blank">'+i[u].summary.title+"<\/a>",b=i[u].onix.ProductIdentifier.IDValue,s=i[u].onix.ProductSupply.SupplyDetail.Price[0].CurrencyCode;s=s=="JPY"?"円":" ("+s+")";var y=i[u].onix.ProductSupply.SupplyDetail.Price[0].PriceAmount,p=r[u],w='<ul style="list-style-type: none;margin: 0px 0px 0px 10px;padding: 0px 0px 0px 0px;"><li>'+v+"<\/li><li>作者　："+h+"<\/li><li>出版社："+i[u].summary.publisher+"<\/li><li>出版日："+c+"<\/li><li>価格　："+y+s+"<\/li>"+f+"<\/ul>";$("#"+p).append('<table border="0" width="'+n.width+'"><tr><td width= "'+n.width_cover+'" valign="top">'+l+'<\/td><td valign="top">'+w+"<\/td><\/tr>")}},error:function(n,t,i){console.log(n,t,i)}})},n.prototype.load_amazon=function(){for(var n in this.amazon_links)$("#amazon_"+n).append(this.amazon_links[n])},n.prototype.createLink=function(n){this.isASIN(n)?this.createAmazonLink(n):this.createDBLink(n)},n.prototype.createDBLink=function(n){this.db_links_id[n]="db_"+n;document.write('<div class="blogbib" id="db_'+n+'"><\/div>')},n.prototype.getAmazonURL=function(n){return this.amazon_account?"https://www.amazon.co.jp/dp/"+n+"/ref=as_li_ss_tl?tag="+this.amazon_account:"https://www.amazon.co.jp/dp/"+n+"/ref=as_li_ss_tl?"},n.prototype.createAmazonURL=function(n,t){var i=this.getAmazonURL(n),r='<a href="'+i+'" target="_blank">'+t+"<\/a>";document.write(r)},n.prototype.getAmazonLink=function(n){var t={lt1:"_blank",bc1:"f0f0f0",IS2:"1",bg1:"f0f0f0",fc1:"080808",lc1:"0000FF",o:"9",p:"8",l:"as4",m:"amazon",f:"ifr",ref:"ss_til",asins:n},i,r,u;$.extend(t,{t:this.amazon_account});i=[];for(r in t)u=t[r],i.push(r+"="+u);return'<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?'+i.join("&")+'" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"><\/iframe>'},n.prototype.getAmazonCover=function(n){return this.amazon_account?'<a href="https://www.amazon.co.jp/dp/'+n+"/ref=as_li_ss_il?&linkCode=li3&tag="+this.amazon_account+'" target="_blank"><img border= "0" src= "//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN='+n+"&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag="+this.amazon_account+'" ><\/a><img src= "https://ir-jp.amazon-adsystem.com/e/ir?t='+this.amazon_account+"&l=li3&o=9&a="+n+'" width= "1" height= "1" border= "0" alt= "" style= "border:none !important; margin:0px !important;" />':'<a href="https://www.amazon.co.jp/dp/'+n+'/ref=as_li_ss_il?&linkCode=li3" target="_blank"><img border= "0" src= "//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN='+n+'&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1" ><\/a><img src= "https://ir-jp.amazon-adsystem.com/e/ir?l=li3&o=9&a='+n+'" width= "1" height= "1" border= "0" alt= "" style= "border:none !important; margin:0px !important;" />'},n.prototype.createAmazonLink=function(n){this.amazon_links[n]=this.getAmazonLink(n);document.write('<div class="blogbib" id="amazon_'+n+'"><\/div>')},n}(),blogbib=new BlogBib;window.onload=function(){blogbib.load_amazon();blogbib.load_db()};