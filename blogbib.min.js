var BlogBib=function(){function n(n){n===void 0&&(n={});this.width_cover=150;this.width_text=300;this.width=450;this.endpoint="http://api.openbd.jp/v1/";this.amazon_links={};this.db_links_id={};this.cover_mode="amazon";this.link_mode="amazon";this.amazon_link_mode="cover";this.amazon_account=null;$.extend(this,n)}return n.prototype.isASIN=function(n){return n.match(/^[^0-9]/)?!0:!1},n.prototype.convDate=function(n){var t=n.substr(0,4),i=n.substr(4,2),r=n.substr(6,2);return t+"/"+i+"/"+r},n.prototype.toISBN10=function(n){var t,u,r,f,i;if(n.length>10){for(t=[],t=n.substr(3,9).split(""),u=0,i=0;i<9;i++)u+=t[i]*(10-i);return r=11-u%11,f=r==10?"X":r==11?0:r,t.push(f),t.join("")}return n},n.prototype.load_db=function(){var n=this,t=[],r=[],i,u;for(i in this.db_links_id)r.push(this.db_links_id[i]),t.push(i);u="isbn="+t.join(",");$.ajax({type:"POST",url:this.endpoint+"get",data:u,success:function(i){for(var h,c,l,f,o,s,u=0;u<i.length;u++){if(h=i[u].summary.author,c=n.convDate(i[u].summary.pubdate),l=n.cover_mode=="amazon"?n.getAmazonCover(n.toISBN10(t[u])):'<img src= "'+i[u].summary.cover+'" alt= "image" />',f="",o=i[u].onix.CollateralDetail.TextContent,o){for(f+="<li>",s=0;s<o.length;s++)f+="<p>"+o[s].Text+"<\/p>";f+="<\/li>"}var v=n.getAmazonURL(n.toISBN10(t[u])),y='<a href="'+v+'" target="_blank">'+i[u].summary.title+"<\/a>",nt=i[u].onix.ProductIdentifier.IDValue,e="",a="";try{e=i[u].onix.ProductSupply.SupplyDetail.Price[0].CurrencyCode;e=e=="JPY"?"円":" ("+e+")";a=i[u].onix.ProductSupply.SupplyDetail.Price[0].PriceAmount}catch(p){console.log(p)}var w=r[u],b='<ul style="list-style-type: none;margin: 0px 0px 0px 10px;padding: 0px 0px 0px 0px;"><li>'+y+"<\/li><li>作者　："+h+"<\/li><li>出版社："+i[u].summary.publisher+"<\/li><li>出版日："+c+"<\/li><li>価格　："+a+e+"<\/li>"+f+"<\/ul>",k='<table border="0" width="'+n.width+'"><tr>',d='<td width= "'+n.width_cover+'" valign="top">'+l+"<\/td>",g='<td width= "'+n.width_text+'" valign= "top"> '+b+" <\/td>";$("#"+w).append(k+d+g+"<\/tr><\/table>")}},error:function(n,t,i){console.log(n,t,i)}})},n.prototype.load_amazon=function(){for(var n in this.amazon_links)$("#amazon_"+n).append(this.amazon_links[n])},n.prototype.createLink=function(n,t){t===void 0&&(t=null);this.isASIN(n)?this.createAmazonLink(n,t):this.createDBLink(n,t)},n.prototype.createDBLink=function(n,t){t===void 0&&(t=null);this.db_links_id[n]="db_"+n;var i='<div class="blogbib" id="db_'+n+'"><\/div>';t==null?document.write(i):t.append(i)},n.prototype.getAmazonURL=function(n){return this.amazon_account?"https://www.amazon.co.jp/dp/"+n+"/ref=as_li_ss_tl?tag="+this.amazon_account:"https://www.amazon.co.jp/dp/"+n+"/ref=as_li_ss_tl?"},n.prototype.createAmazonURL=function(n,t,i){i===void 0&&(i=null);var u=this.getAmazonURL(n),r='<a href="'+u+'" target="_blank">'+t+"<\/a>";i==null?document.write(r):i.append(r)},n.prototype.getAmazonLink=function(n){var t={lt1:"_blank",bc1:"f0f0f0",IS2:"1",bg1:"f0f0f0",fc1:"080808",lc1:"0000FF",o:"9",p:"8",l:"as4",m:"amazon",f:"ifr",ref:"ss_til",asins:n},i,r,u;$.extend(t,{t:this.amazon_account});i=[];for(r in t)u=t[r],i.push(r+"="+u);return'<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?'+i.join("&")+'" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"><\/iframe>'},n.prototype.getAmazonCover=function(n){return this.amazon_account?'<a href="https://www.amazon.co.jp/dp/'+n+"/ref=as_li_ss_il?&linkCode=li3&tag="+this.amazon_account+'" target="_blank"><img border= "0" src= "//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN='+n+"&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag="+this.amazon_account+'" ><\/a><img src= "https://ir-jp.amazon-adsystem.com/e/ir?t='+this.amazon_account+"&l=li3&o=9&a="+n+'" width= "1" height= "1" border= "0" alt= "" style= "border:none !important; margin:0px !important;" />':'<a href="https://www.amazon.co.jp/dp/'+n+'/ref=as_li_ss_il?&linkCode=li3" target="_blank"><img border= "0" src= "//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN='+n+'&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1" ><\/a><img src= "https://ir-jp.amazon-adsystem.com/e/ir?l=li3&o=9&a='+n+'" width= "1" height= "1" border= "0" alt= "" style= "border:none !important; margin:0px !important;" />'},n.prototype.createAmazonLink=function(n,t){var i,r;t===void 0&&(t=null);i="";this.amazon_link_mode=="cover"?(r=this.getAmazonCover(n),i='<div class="blogbib" id="amazon_'+n+'">'+r+"<\/div>"):(this.amazon_links[n]=this.getAmazonLink(n),i='<div class="blogbib" id="amazon_'+n+'"><\/div>');t==null?document.write(i):t.append(i)},n}(),blogbib=new BlogBib;$(window).ready(function(){console.log("[ready]");$.event.add(window,"load",function(){console.log("[Init]");blogbib.load_amazon();blogbib.load_db()})});